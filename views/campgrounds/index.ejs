<%= layout('layout/boilerplate') %>
<style>
  .backmap{
    width: 100%;
    height: 90vh;
    background-color: black;
    display: flex;
    justify-content: center;
    justify-items: center;
    align-items: center;
     background-image: linear-gradient(rgba(0, 0, 0, 0.70),rgba(0, 0, 0, 0.70) ), url('/images/back.jpg');
background-size: cover;
background-position: center;
  }

</style>


<div class="pt-3  backmap ">
  <div class="container" style="  padding-bottom: 1rem;
">
     <h1 style="font-size: 3rem; margin-bottom: 10px; color:white; text-align: center;">Explore the Wild</h1>
  <p style="font-size: 1.25rem; margin-bottom: 20px; color:white; text-align: center;">Discover amazing campgrounds across the country on the map below</p>
<div id="cluster-map" style="
  height: 600px;
  width: 100%;
  max-width: 100%;
  margin: 0 auto;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 8px 20px rgba(255, 255, 255, 0.305);
  z-index: 1;
  position: relative;
"></div>
</div></div>
<div class="container">


<h1 class="text-center mt-5 mb-3 ">List of Camps</h1>

  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    <% for(camps of campgrounds){ %>
    <div class="col">
      <div class="card h-100">
        <div class="ratio ratio-16x9">
              <img src="<%= camps.images[0].url %>" class='img-fluis' alt="">
        </div>
                <div class="card-body d-flex flex-column">
          <h5 class="card-title"><%= camps.title %></h5>
          <p class="card-text flex-grow-1"><%= camps.description %></p>
          <div class="mt-auto">
            <a class="btn btn-primary" href="/campgrounds/<%= camps._id %>">See More</a>
          </div>
        </div>
      </div>
    </div>
    <% } %>
  </div>
  
  <div class="text-center mt-4 mb-4">
    <a class="btn btn-primary" href="/campgrounds/new">Submit New Campground</a>
  </div>
</div>
<script>
  const campgrounds = JSON.parse('<%- JSON.stringify(campgrounds)%>');
</script>

<script>
  const map = L.map('cluster-map').setView([32.0, 53.0], 5); // Centered on Iran

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  const markers = L.markerClusterGroup();

  campgrounds.forEach(camp => {
    if (!camp.geometry || !camp.geometry.coordinates) return;

    const [lng, lat] = camp.geometry.coordinates;
    const admin_name = camp.admin_name || 'Unknown Province';

    const marker = L.marker([lat, lng]).bindPopup(
  `<a href="/campgrounds/${camp._id}" target="_blank" rel="noopener noreferrer">${camp.title}</a>`
);

    markers.addLayer(marker);
  });

  map.addLayer(markers);
</script>


